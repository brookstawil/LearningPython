

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>10. Event-Driven Programming &mdash; How to Think Like a Computer Scientist: Learning with Python 3</title>
    
    <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '3rd Edition',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="How to Think Like a Computer Scientist: Learning with Python 3" href="index.html" />
    <link rel="next" title="11. Lists" href="lists.html" />
    <link rel="prev" title="9. Tuples" href="tuples.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="lists.html" title="11. Lists"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tuples.html" title="9. Tuples"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">How to Think Like a Computer Scientist: Learning with Python 3</a> &raquo;</li> 
      </ul>
    </div>

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="event-driven-programming">
<span id="index-0"></span><h1>10. Event-Driven Programming<a class="headerlink" href="#event-driven-programming" title="Permalink to this headline">¶</a></h1>
<p>Most programs and devices like a cellphone respond to <em>events</em> &#8212; things that happen.
For example, you might move your mouse, and the computer responds.  Or you click a button,
and the program does something interesting.   In this chapter we&#8217;ll touch very briefly on
how event-driven programming works.</p>
<div class="section" id="keypress-events">
<h2>10.1. Keypress events<a class="headerlink" href="#keypress-events" title="Permalink to this headline">¶</a></h2>
<p>Here&#8217;s a program with some new features.  Copy it into your workspace, run it.  When the
turtle window opens, press the arrow keys and make tess move about!</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">turtle</span>

<span class="n">turtle</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>                <span class="c"># Determine the window size</span>
<span class="n">wn</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Screen</span><span class="p">()</span>                 <span class="c"># Get a reference to the window</span>
<span class="n">wn</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Handling keypresses!&quot;</span><span class="p">)</span>     <span class="c"># Change the window title</span>
<span class="n">wn</span><span class="o">.</span><span class="n">bgcolor</span><span class="p">(</span><span class="s">&quot;lightgreen&quot;</span><span class="p">)</span>             <span class="c"># Set the background color</span>
<span class="n">tess</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Turtle</span><span class="p">()</span>               <span class="c"># Create our favorite turtle</span>

<span class="c"># The next four functions are our &quot;event handlers&quot;.</span>
<span class="k">def</span> <span class="nf">h1</span><span class="p">():</span>
   <span class="n">tess</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">h2</span><span class="p">():</span>
   <span class="n">tess</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">h3</span><span class="p">():</span>
   <span class="n">tess</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">h4</span><span class="p">():</span>
    <span class="n">wn</span><span class="o">.</span><span class="n">bye</span><span class="p">()</span>                        <span class="c"># Close down the turtle window</span>

<span class="c"># These lines &quot;wire up&quot; keypresses to the handlers we&#39;ve defined.</span>
<span class="n">wn</span><span class="o">.</span><span class="n">onkey</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="s">&quot;Up&quot;</span><span class="p">)</span>
<span class="n">wn</span><span class="o">.</span><span class="n">onkey</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">)</span>
<span class="n">wn</span><span class="o">.</span><span class="n">onkey</span><span class="p">(</span><span class="n">h3</span><span class="p">,</span> <span class="s">&quot;Right&quot;</span><span class="p">)</span>
<span class="n">wn</span><span class="o">.</span><span class="n">onkey</span><span class="p">(</span><span class="n">h4</span><span class="p">,</span> <span class="s">&quot;q&quot;</span><span class="p">)</span>

<span class="c"># Now we need to tell the window to start listening for events,</span>
<span class="c"># If any of the keys that we&#39;re monitoring is pressed, its</span>
<span class="c"># handler will be called.</span>
<span class="n">wn</span><span class="o">.</span><span class="n">listen</span><span class="p">()</span>
<span class="n">wn</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>Here are some points to note:</p>
<ul class="simple">
<li>We need the call to the window&#8217;s <tt class="docutils literal"><span class="pre">listen</span></tt> method at line 31, otherwise it won&#8217;t notice our keypresses.</li>
<li>We named our handler functions <tt class="docutils literal"><span class="pre">h1</span></tt>, <tt class="docutils literal"><span class="pre">h2</span></tt> and so on, but we can choose better names.  The handlers can be
arbitrarily complex functions that call other functions, etc.</li>
<li>Pressing the <tt class="docutils literal"><span class="pre">q</span></tt> key on the keyboard calls function <tt class="docutils literal"><span class="pre">h4</span></tt> (because we <cite>bound</cite> the <tt class="docutils literal"><span class="pre">q</span></tt> key to <tt class="docutils literal"><span class="pre">h4</span></tt> on line 26).
While executing <tt class="docutils literal"><span class="pre">h4</span></tt>, the window&#8217;s <tt class="docutils literal"><span class="pre">bye</span></tt> method (line 24) closes the turtle window, which causes the window&#8217;s
mainloop call (line 31) to end its execution.  Since we did not write any more statements after line 32, this means
that our program has completed everything, so it too will terminate.</li>
<li>We can refer to keys on the keyboard by their character code (as we did in line 26), or by their symbolic names.
Some of the symbolic names to try are Cancel (the Break key), BackSpace, Tab, Return(the Enter key),
Shift_L (any Shift key), Control_L (any Control key), Alt_L (any Alt key), Pause, Caps_Lock, Escape, Prior (Page Up),
Next (Page Down), End, Home, Left, Up, Right, Down, Print, Insert, Delete, F1, F2, F3, F4, F5, F6, F7, F8, F9, F10,
F11, F12, Num_Lock, and Scroll_Lock.</li>
</ul>
</div>
<div class="section" id="mouse-events">
<h2>10.2. Mouse events<a class="headerlink" href="#mouse-events" title="Permalink to this headline">¶</a></h2>
<p>A mouse event is a bit different from a keypress event because its handler needs two parameters
to receive x,y coordinate information telling us where the mouse was when the event occurred.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">turtle</span>

<span class="n">turtle</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
<span class="n">wn</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Screen</span><span class="p">()</span>
<span class="n">wn</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;How to handle mouse clicks on the window!&quot;</span><span class="p">)</span>
<span class="n">wn</span><span class="o">.</span><span class="n">bgcolor</span><span class="p">(</span><span class="s">&quot;lightgreen&quot;</span><span class="p">)</span>

<span class="n">tess</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Turtle</span><span class="p">()</span>
<span class="n">tess</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s">&quot;purple&quot;</span><span class="p">)</span>
<span class="n">tess</span><span class="o">.</span><span class="n">pensize</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">tess</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="s">&quot;circle&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">h1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
   <span class="n">tess</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">wn</span><span class="o">.</span><span class="n">onclick</span><span class="p">(</span><span class="n">h1</span><span class="p">)</span>  <span class="c"># Wire up a click on the window.</span>
<span class="n">wn</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>There is a new turtle method used at line 14 &#8212; this allows us to move the turtle to an <em>absolute</em>
coordinate position.  (Most of the examples that we&#8217;ve seen so far move the turtle <em>relative</em> to where
it currently is).   So what this program does is move the turtle (and draw a line) to wherever
the mouse is clicked.  Try it out!</p>
<p>If we add this line before line 14, we&#8217;ll learn a useful debugging trick too:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">wn</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Got click at coords {0}, {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<p>Because we can easily change the text in the window&#8217;s title bar, it is a useful place to display
occasional debugging or status information. (Of course, this is not the real purpose of the window
title!)</p>
<p>But there is more!</p>
<p>Not only can the window receive mouse events: individual turtles can also
have their own handlers for mouse clicks.  The turtle that
&#8220;receives&#8221; the click event will be the one under the mouse.   So we&#8217;ll create
two turtles.  Each will bind a handler to its own <tt class="docutils literal"><span class="pre">onclick</span></tt> event.  And the
two handlers can do different things for their turtles.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">turtle</span>

<span class="n">turtle</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>              <span class="c"># Determine the window size</span>
<span class="n">wn</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Screen</span><span class="p">()</span>               <span class="c"># Get a reference to the window</span>
<span class="n">wn</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Handling mouse clicks!&quot;</span><span class="p">)</span> <span class="c"># Change the window title</span>
<span class="n">wn</span><span class="o">.</span><span class="n">bgcolor</span><span class="p">(</span><span class="s">&quot;lightgreen&quot;</span><span class="p">)</span>           <span class="c"># Set the background color</span>
<span class="n">tess</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Turtle</span><span class="p">()</span>             <span class="c"># Create two turtles</span>
<span class="n">tess</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s">&quot;purple&quot;</span><span class="p">)</span>
<span class="n">alex</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Turtle</span><span class="p">()</span>             <span class="c"># Move them apart</span>
<span class="n">alex</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">alex</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">handler_for_tess</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">wn</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Tess clicked at {0}, {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="n">tess</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">tess</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">handler_for_alex</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">wn</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Alex clicked at {0}, {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="n">alex</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span>
    <span class="n">alex</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>

<span class="n">tess</span><span class="o">.</span><span class="n">onclick</span><span class="p">(</span><span class="n">handler_for_tess</span><span class="p">)</span>
<span class="n">alex</span><span class="o">.</span><span class="n">onclick</span><span class="p">(</span><span class="n">handler_for_alex</span><span class="p">)</span>

<span class="n">wn</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>Run this, click on the turtles, see what happens!</p>
</div>
<div class="section" id="automatic-events-from-a-timer">
<h2>10.3. Automatic events from a timer<a class="headerlink" href="#automatic-events-from-a-timer" title="Permalink to this headline">¶</a></h2>
<p>Alarm clocks, kitchen timers, and thermonuclear bombs in James Bond movies are set to
create an &#8220;automatic&#8221; event after a certain interval. The turtle module in Python has a
timer that can cause an event when its time is up.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">turtle</span>

<span class="n">turtle</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
<span class="n">wn</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Screen</span><span class="p">()</span>
<span class="n">wn</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Using a timer&quot;</span><span class="p">)</span>
<span class="n">wn</span><span class="o">.</span><span class="n">bgcolor</span><span class="p">(</span><span class="s">&quot;lightgreen&quot;</span><span class="p">)</span>

<span class="n">tess</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Turtle</span><span class="p">()</span>
<span class="n">tess</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s">&quot;purple&quot;</span><span class="p">)</span>
<span class="n">tess</span><span class="o">.</span><span class="n">pensize</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">h1</span><span class="p">():</span>
    <span class="n">tess</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">tess</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="mi">56</span><span class="p">)</span>

<span class="n">wn</span><span class="o">.</span><span class="n">ontimer</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">wn</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>On line 16 the timer is started and set to explode in 2000 milliseconds (2 seconds). When the event does occur,
the handler is called, and tess springs into action.</p>
<p>Unfortunately, when one sets a timer, it only goes off once. So a common idiom, or style, is to restart
the timer inside the handler.  In this way the timer will keep on giving new events.  Try this program:</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">turtle</span>

<span class="n">turtle</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
<span class="n">wn</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Screen</span><span class="p">()</span>
<span class="n">wn</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Using a timer to get events!&quot;</span><span class="p">)</span>
<span class="n">wn</span><span class="o">.</span><span class="n">bgcolor</span><span class="p">(</span><span class="s">&quot;lightgreen&quot;</span><span class="p">)</span>

<span class="n">tess</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Turtle</span><span class="p">()</span>
<span class="n">tess</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s">&quot;purple&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">h1</span><span class="p">():</span>
    <span class="n">tess</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">tess</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="mi">56</span><span class="p">)</span>
    <span class="n">wn</span><span class="o">.</span><span class="n">ontimer</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>

<span class="n">h1</span><span class="p">()</span>
<span class="n">wn</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="an-example-state-machines">
<h2>10.4. An example: state machines<a class="headerlink" href="#an-example-state-machines" title="Permalink to this headline">¶</a></h2>
<p>A state machine is a system that can be in one of a few different <cite>states</cite>. We draw a
state diagram to represent the machine, where each state is drawn as a circle or an ellipse.
Certain events occur which cause the system to leave one state and <cite>transition</cite> into a
different state.  These <cite>state transitions</cite> are usually drawn as an arrow on the diagram.</p>
<p>This idea is not new: when first turning on a cellphone, it goes into a
state which we could call &#8220;Awaiting PIN&#8221;.  When the correct PIN is entered, it
transitions into a different state &#8212; say &#8220;Ready&#8221;.  Then we could lock the phone, and it
would enter a &#8220;Locked&#8221; state, and so on.</p>
<p>A simple state machine that we encounter often is a traffic light.  Here
is a state diagram which shows that the machine continually cycles through three different
states, which we&#8217;ve numbered 0, 1 and 2.</p>
<blockquote>
<div><img alt="_images/fsm_traffic_lights.png" src="_images/fsm_traffic_lights.png" />
</div></blockquote>
<p>We&#8217;re going to build a program that uses a turtle to simulate the traffic lights.
There are three lessons here. The first shows off some different ways to use our turtles.
The second demonstrates how we would program a state machine in Python, by using a variable
to keep track of the current state, and a number of different <tt class="docutils literal"><span class="pre">if</span></tt> statements to
inspect the current state, and take the actions as we change to a different state.
The third lesson is to use events from the keyboard to trigger the state changes.</p>
<p>Copy and run this program.  Make sure you understand what each line does, consulting the
documentation as you need to.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">turtle</span>           <span class="c"># Tess becomes a traffic light.</span>

<span class="n">turtle</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
<span class="n">wn</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Screen</span><span class="p">()</span>
<span class="n">wn</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Tess becomes a traffic light!&quot;</span><span class="p">)</span>
<span class="n">wn</span><span class="o">.</span><span class="n">bgcolor</span><span class="p">(</span><span class="s">&quot;lightgreen&quot;</span><span class="p">)</span>
<span class="n">tess</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Turtle</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">draw_housing</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Draw a nice housing to hold the traffic lights &quot;&quot;&quot;</span>
    <span class="n">tess</span><span class="o">.</span><span class="n">pensize</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">tess</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s">&quot;black&quot;</span><span class="p">,</span> <span class="s">&quot;darkgrey&quot;</span><span class="p">)</span>
    <span class="n">tess</span><span class="o">.</span><span class="n">begin_fill</span><span class="p">()</span>
    <span class="n">tess</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>
    <span class="n">tess</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">tess</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">tess</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
    <span class="n">tess</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">tess</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">tess</span><span class="o">.</span><span class="n">end_fill</span><span class="p">()</span>


<span class="n">draw_housing</span><span class="p">()</span>

<span class="n">tess</span><span class="o">.</span><span class="n">penup</span><span class="p">()</span>
<span class="c"># Position tess onto the place where the green light should be</span>
<span class="n">tess</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
<span class="n">tess</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
<span class="n">tess</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="c"># Turn tess into a big green circle</span>
<span class="n">tess</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="s">&quot;circle&quot;</span><span class="p">)</span>
<span class="n">tess</span><span class="o">.</span><span class="n">shapesize</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">tess</span><span class="o">.</span><span class="n">fillcolor</span><span class="p">(</span><span class="s">&quot;green&quot;</span><span class="p">)</span>

<span class="c"># A traffic light is a kind of state machine with three states,</span>
<span class="c"># Green, Orange, Red.  We number these states  0, 1, 2</span>
<span class="c"># When the machine changes state, we change tess&#39; position and</span>
<span class="c"># her fillcolor.</span>

<span class="c"># This variable holds the current state of the machine</span>
<span class="n">state_num</span> <span class="o">=</span> <span class="mi">0</span>


<span class="k">def</span> <span class="nf">advance_state_machine</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">state_num</span>
    <span class="k">if</span> <span class="n">state_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>       <span class="c"># Transition from state 0 to state 1</span>
        <span class="n">tess</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
        <span class="n">tess</span><span class="o">.</span><span class="n">fillcolor</span><span class="p">(</span><span class="s">&quot;orange&quot;</span><span class="p">)</span>
        <span class="n">state_num</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">state_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>     <span class="c"># Transition from state 1 to state 2</span>
        <span class="n">tess</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
        <span class="n">tess</span><span class="o">.</span><span class="n">fillcolor</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
        <span class="n">state_num</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>                    <span class="c"># Transition from state 2 to state 0</span>
        <span class="n">tess</span><span class="o">.</span><span class="n">back</span><span class="p">(</span><span class="mi">140</span><span class="p">)</span>
        <span class="n">tess</span><span class="o">.</span><span class="n">fillcolor</span><span class="p">(</span><span class="s">&quot;green&quot;</span><span class="p">)</span>
        <span class="n">state_num</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c"># Bind the event handler to the space key.</span>
<span class="n">wn</span><span class="o">.</span><span class="n">onkey</span><span class="p">(</span><span class="n">advance_state_machine</span><span class="p">,</span> <span class="s">&quot;space&quot;</span><span class="p">)</span>

<span class="n">wn</span><span class="o">.</span><span class="n">listen</span><span class="p">()</span>                      <span class="c"># Listen for events</span>
<span class="n">wn</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>The new Python statement is at line 46.  The <tt class="docutils literal"><span class="pre">global</span></tt> keyword tells Python not to
create a new local variable for <tt class="docutils literal"><span class="pre">state_num</span></tt> (in spite of the fact that
the function assigns to this variable at lines 50, 54, and 58).  Instead, in this function,
<tt class="docutils literal"><span class="pre">state_num</span></tt> always refers to the variable that was created at line 42.</p>
<p>What the code in <tt class="docutils literal"><span class="pre">advance_state_machine</span></tt> does is advance from whatever
the current state is, to the next state.  On the state change we move tess
to her new position, change her color, and, of course, we assign to <tt class="docutils literal"><span class="pre">state_num</span></tt>
the number of the new state we&#8217;ve just entered.</p>
<p>Each time the space bar is pressed, the event handler causes the traffic light
machine to move to its new state.</p>
</div>
<div class="section" id="glossary">
<h2>10.5. Glossary<a class="headerlink" href="#glossary" title="Permalink to this headline">¶</a></h2>
<dl class="glossary docutils">
<dt id="term-bind">bind</dt>
<dd>We bind a function (or associate it) with an event, meaning that when the event occurs, the
function is called to handle it.</dd>
<dt id="term-event">event</dt>
<dd>Something that happens &#8220;outside&#8221; the normal control flow of our program, usually from some user action.
Typical events are mouse operations and keypresses.  We&#8217;ve also seen that a timer can be primed
to create an event.</dd>
<dt id="term-handler">handler</dt>
<dd>A function that is called in response to an event.</dd>
</dl>
</div>
<div class="section" id="exercises">
<h2>10.6. Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Add some new key bindings to the first sample program:</p>
<ul class="simple">
<li>Pressing keys R, G or B should change tess&#8217; color to Red, Green or Blue.</li>
<li>Pressing keys + or - should increase or decrease the width of tess&#8217; pen.
Ensure that the pen size stays between 1 and 20 (inclusive).</li>
<li>Handle some other keys to change some attributes of tess, or attributes of the window,
or to give her new behaviour that can be controlled from the keyboard.</li>
</ul>
</li>
<li><p class="first">Change the traffic light program so that changes occur automatically, driven by a timer.</p>
</li>
<li><p class="first">In an earlier chapter we saw two turtle methods, <tt class="docutils literal"><span class="pre">hideturtle</span></tt> and <tt class="docutils literal"><span class="pre">showturtle</span></tt> that
can hide or show a turtle.  This suggests that we could take a different approach to
the traffic lights program.  Modify the program so that we create three separate
turtles for each of the green, orange and red lights, and instead of moving tess to
different positions and changing her color, we just make one of the three turtles visible
at any time. Once you&#8217;ve made the changes, sit back and ponder some deep thoughts: you&#8217;ve
got two programs, both seem to do the same thing. Is one approach somehow preferable to
the other?  Which one more closely resembles reality &#8212; i.e. the traffic lights in your town?</p>
</li>
<li><p class="first">Now that you&#8217;ve got a traffic light program with different turtles for each light, perhaps
the visibility / invisibility trick wasn&#8217;t such a great idea. If we watch the traffic lights, they
turn on and off &#8212; but when they&#8217;re off they are still there, perhaps just a darker color.
Modify the program now so that the lights don&#8217;t disappear: they are either on, or off. But when
they&#8217;re off, they&#8217;re still visible.</p>
</li>
<li><p class="first">Your traffic light controller program has been patented, and you&#8217;re about to
become seriously rich.  But your new client needs a change.  They want
four states in their state machine: Green, then Green and Orange together,
then Orange only, and then Red.  Additionally, they want different
times spent in each state.  The machine should spend 3 seconds in the Green state,
followed by one second in the Green+Orange state, then one second in
the Orange state, and then 2 seconds in the Red state.
Change the logic in the state machine.</p>
</li>
<li><p class="first">If you don&#8217;t know how tennis scoring works, ask a friend or consult Wikipedia.  A single
game in tennis between player A and player B always has a score.  We want to think
about the &#8220;state of the score&#8221; as a state machine.   The game starts in state (0, 0), meaning
neither player has any score yet.  We&#8217;ll assume the first element in this pair is the score
for player A.   If player A wins the first point, the score becomes (15, 0).
If B wins the first point, the state becomes (0, 15).  Below are the first
few states and transitions for a state diagram. In this diagram, each state
has two possible outcomes (A wins the next point, or B does), and the
uppermost arrow is always the transition that happens when A wins the point.
Complete the diagram, showing all transitions and all states.
(Hint: there are twenty states, if you include the duece state, the advantage states,
and the &#8220;A wins&#8221; and &#8220;B wins&#8221; states in your diagram.)</p>
<img alt="_images/fsm_tennis_scores.png" src="_images/fsm_tennis_scores.png" />
</li>
</ol>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="lists.html" title="11. Lists"
             >next</a> |</li>
        <li class="right" >
          <a href="tuples.html" title="9. Tuples"
             >previous</a> |</li>
        <li><a href="index.html">How to Think Like a Computer Scientist: Learning with Python 3</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Peter Wentworth, Jeffrey Elkner, Allen B. Downey and Chris Meyers.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>